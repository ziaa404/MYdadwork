<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ŸÜÿ∏ÿßŸÖ ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ∑ŸÑÿßÿ®</title>
  <style>
    /* =================== RESET & BASE =================== */
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height:100vh; padding:20px; color:#1d1d1f;
    }
    a, button { font-family: inherit; }

    /* =================== LAYOUT =================== */
    .container {
      max-width:1400px; margin: auto;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius:20px; padding:30px;
      box-shadow:0 10px 40px rgba(0,0,0,0.1);
    }
    .header { text-align:center; margin-bottom:40px; }
    .header h1 { font-size:2.5rem; font-weight:600; color:#1d1d1f; }
    .header p { color:#86868b; font-size:1.2rem; margin-top:10px; }

    .controls {
      display:flex; gap:15px; flex-wrap:wrap;
      justify-content: space-between; margin-bottom:30px;
      align-items: center;
    }
    .search-box {
      flex:1; max-width:350px;
      padding:15px 20px; border:2px solid #e5e5e7;
      border-radius:12px; font-size:16px;
      transition:border-color .3s;
    }
    .search-box:focus { outline:none; border-color:#007aff; }

    .students-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(320px,1fr));
      gap:25px; margin-bottom:30px;
    }

    .student-card {
      background:white; border-radius:16px; padding:25px;
      box-shadow:0 4px 20px rgba(0,0,0,0.08);
      transition:all .3s; cursor:pointer; border:2px solid transparent;
      position: relative;
    }
    .student-card:hover {
      transform:translateY(-3px);
      box-shadow:0 8px 30px rgba(0,0,0,0.15);
      border-color:#007aff;
    }

    .student-photo {
      width:70px; height:70px; border-radius:50%;
      margin:0 auto 15px; background:#f0f0f0;
      display:flex; align-items:center; justify-content:center;
      font-size:1.8rem; color:#666; overflow:hidden;
      border: 3px solid #e5e5e7;
    }
    .student-photo img { width:100%; height:100%; object-fit:cover; }

    .student-info h3 { 
      text-align:center; margin-bottom:8px; font-size:1.4rem; 
      color:#1d1d1f;
    }
    .student-info .grade { 
      text-align:center; color:#007aff; margin-bottom:15px; 
      font-weight:500; font-size:1rem;
    }

    /* ÿ£ÿØÿßÿ® ÿßŸÑÿ∑ÿßŸÑÿ® */
    .behavior-indicator {
      text-align: center; margin-bottom: 15px;
      padding: 8px; border-radius: 8px; font-size: 0.9rem; font-weight: 500;
    }
    .behavior-excellent { background: #d4edda; color: #155724; }
    .behavior-good { background: #fff3cd; color: #856404; }
    .behavior-needs-improvement { background: #f8d7da; color: #721c24; }

    .student-stats { 
      display:grid; grid-template-columns: 1fr 1fr 1fr; 
      gap:10px; margin-bottom:15px;
    }
    .stat { 
      text-align:center; padding:8px; background:#f8f9fa; 
      border-radius:8px;
    }
    .stat-value { 
      font-size:1.1rem; font-weight:600; color:#007aff; 
      display:block;
    }
    .stat-label { 
      font-size:.7rem; color:#86868b; margin-top:2px;
    }

    .quick-actions {
      display:flex; gap:8px; justify-content:center;
    }
    .action-btn {
      padding:8px 16px; border:none; border-radius:20px;
      font-size:12px; font-weight:500; cursor:pointer;
      transition:all .3s;
    }
    .btn-evaluate {
      background:#007aff; color:white;
    }
    .btn-evaluate:hover {
      background:#0056cc; transform:translateY(-1px);
    }

    .btn {
      background:linear-gradient(135deg,#007aff,#0056cc);
      color:#fff; border:none;
      padding:15px 30px; border-radius:12px;
      font-size:16px; font-weight:500; cursor:pointer;
      transition:all .3s; box-shadow:0 4px 15px rgba(0,122,255,0.3);
    }
    .btn:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,122,255,0.4); }
    .btn-success {
      background:linear-gradient(135deg,#34c759,#28a745);
      box-shadow:0 4px 15px rgba(52,199,89,0.3);
    }
    .btn-danger {
      background:linear-gradient(135deg,#ff3b30,#dc3545);
      box-shadow:0 4px 15px rgba(255,59,48,0.3);
    }

    /* =================== MODAL =================== */
    .modal {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,0.6); backdrop-filter:blur(10px);
      align-items:center; justify-content:center; z-index:1000;
    }
    .modal[aria-hidden="false"] { display:flex; }
    .modal-content {
      background:white; border-radius:20px; padding:35px;
      width:90%; max-width:700px; max-height:90vh; overflow-y:auto;
      position:relative; outline:none;
    }
    .close {
      position:absolute; top:15px; right:20px;
      font-size:28px; cursor:pointer; color:#86868b;
    }
    .close:hover { color:#1d1d1f; }

    .form-row {
      display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:25px;
    }
    .form-group { margin-bottom:25px; }
    .form-group label { 
      display:block; margin-bottom:10px; font-weight:600; 
      color:#1d1d1f; font-size:14px;
    }
    .form-group input, .form-group select {
      width:100%; padding:15px 18px;
      border:2px solid #e5e5e7; border-radius:12px;
      font-size:16px; transition:border-color .3s;
    }
    .form-group input:focus, .form-group select:focus { 
      outline:none; border-color:#007aff; 
    }

    /* ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© */
    .photo-upload {
      text-align: center; margin-bottom: 25px;
    }
    .photo-preview {
      width: 120px; height: 120px; border-radius: 50%;
      margin: 0 auto 15px; background: #f0f0f0;
      display: flex; align-items: center; justify-content: center;
      font-size: 3rem; color: #666; overflow: hidden;
      border: 3px dashed #e5e5e7; cursor: pointer;
      transition: all 0.3s;
    }
    .photo-preview:hover { border-color: #007aff; }
    .photo-preview img { width: 100%; height: 100%; object-fit: cover; }
    .photo-input { display: none; }
    .photo-label {
      display: inline-block; padding: 10px 20px;
      background: #f8f9fa; border: 2px solid #e5e5e7;
      border-radius: 8px; cursor: pointer; transition: all 0.3s;
    }
    .photo-label:hover { background: #007aff; color: white; }

    .grade-section {
      background:#f8f9fa; padding:25px; border-radius:12px;
      margin-bottom:25px;
    }
    .grade-section h4 {
      margin-bottom:20px; color:#1d1d1f; text-align:center;
      font-size:1.1rem;
    }

    /* ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ */
    .subject-evaluation {
      background: white; border: 2px solid #e5e5e7;
      border-radius: 12px; padding: 20px; margin-bottom: 20px;
    }
    .subject-title {
      font-weight: 600; margin-bottom: 15px; color: #1d1d1f;
      font-size: 1.1rem; text-align: center;
    }
    .evaluation-grid {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 15px; margin-bottom: 15px;
    }
    .evaluation-item label {
      font-size: 0.9rem; margin-bottom: 5px;
    }

    .attendance-section, .homework-section {
      background:#fff; border:2px solid #e5e5e7; 
      padding:20px; border-radius:12px; margin-bottom:20px;
    }
    .section-title {
      font-weight:600; margin-bottom:15px; color:#1d1d1f;
      display:flex; align-items:center; gap:8px;
    }

    /* ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ® */
    .behavior-section {
      background: #f8f9fa; border: 2px solid #e5e5e7;
      border-radius: 12px; padding: 20px; margin-bottom: 20px;
    }
    .behavior-options {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 15px; margin-top: 15px;
    }
    .behavior-option {
      padding: 15px; border: 2px solid #e5e5e7;
      border-radius: 10px; text-align: center; cursor: pointer;
      transition: all 0.3s; font-weight: 500;
    }
    .behavior-option input[type="radio"] { display: none; }
    .behavior-option.excellent { border-color: #28a745; background: #d4edda; }
    .behavior-option.good { border-color: #ffc107; background: #fff3cd; }
    .behavior-option.needs-improvement { border-color: #dc3545; background: #f8d7da; }
    .behavior-option:hover { transform: translateY(-2px); }
    .behavior-option input:checked + .behavior-option {
      transform: scale(1.05);
    }

    .modal-actions {
      display:flex; gap:15px; justify-content:center; margin-top:30px;
    }

    .empty-state {
      text-align:center; color:#86868b; font-size:1.2rem; 
      grid-column:1/-1; padding:60px 20px;
    }
    .empty-state .icon { font-size:3rem; margin-bottom:20px; }

    @media(max-width:768px) {
      .controls { flex-direction:column; align-items:stretch; }
      .search-box { width:100%; }
      .students-grid { grid-template-columns:1fr; }
      .form-row { grid-template-columns:1fr; }
      .student-stats { grid-template-columns:1fr; }
      .evaluation-grid { grid-template-columns: 1fr; }
      .behavior-options { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìö ŸÜÿ∏ÿßŸÖ ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ∑ŸÑÿßÿ®</h1>
      <p>ŸÖÿ™ÿßÿ®ÿπÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ ŸàÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ŸàÿßŸÑÿ¢ÿØÿßÿ®</p>
    </div>

    <div class="controls">
      <button class="btn" id="btnAdd">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ</button>
      <input type="text" id="searchInput" class="search-box" placeholder="üîç ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ∑ÿßŸÑÿ®...">
    </div>

    <div class="students-grid" id="studentsGrid"></div>
  </div>

  <!-- ŸÖŸàÿØÿßŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® -->
  <div id="addModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" tabindex="-1">
      <button class="close" aria-label="ÿ•ÿ∫ŸÑÿßŸÇ">&times;</button>
      <h2>‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ</h2>

      <div class="photo-upload">
        <div class="photo-preview" id="photoPreview" onclick="document.getElementById('photoInput').click()">
          üì∑
        </div>
        <input type="file" id="photoInput" class="photo-input" accept="image/*">
        <label for="photoInput" class="photo-label">ÿßÿÆÿ™ÿ± ÿµŸàÿ±ÿ© ÿßŸÑÿ∑ÿßŸÑÿ®</label>
      </div>

      <div class="form-group">
        <label for="studentName">ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® *</label>
        <input type="text" id="studentName" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ®" required>
      </div>

      <div class="form-group">
        <label for="studentGrade">ÿßŸÑÿµŸÅ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä *</label>
        <select id="studentGrade" required>
          <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ</option>
          <option>ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ±ÿßÿ®ÿπ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿÆÿßŸÖÿ≥ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ≥ÿßÿØÿ≥ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
        </select>
      </div>

      <div class="modal-actions">
        <button class="btn btn-success" id="saveStudent">ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ∑ÿßŸÑÿ®</button>
        <button class="btn" id="cancelAdd">ÿ•ŸÑÿ∫ÿßÿ°</button>
      </div>
    </div>
  </div>

  <!-- ŸÖŸàÿØÿßŸÑ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® -->
  <div id="evaluateModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" tabindex="-1">
      <button class="close" aria-label="ÿ•ÿ∫ŸÑÿßŸÇ">&times;</button>
      <h2>üìù ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ∑ÿßŸÑÿ®</h2>
      <h3 id="currentStudentName" style="text-align:center; color:#007aff; margin-bottom:25px;"></h3>

      <!-- ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ -->
      <div class="subject-evaluation">
        <div class="subject-title">üïå ŸÖÿßÿØÿ© ÿßŸÑÿØŸäŸÜ</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="religionHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="religionExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßŸÜÿ™ÿ∏ÿßŸÖ (ŸÖŸÜ 10)</label>
            <input type="number" id="religionAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <div class="subject-evaluation">
        <div class="subject-title">üìñ ŸÖÿßÿØÿ© ÿßŸÑŸÇÿ±ÿßÿ°ÿ©</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="readingHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="readingExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßŸÜÿ™ÿ∏ÿßŸÖ (ŸÖŸÜ 10)</label>
            <input type="number" id="readingAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <div class="subject-evaluation">
        <div class="subject-title">‚úèÔ∏è ŸÖÿßÿØÿ© ÿßŸÑÿ•ŸÖŸÑÿßÿ°</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="spellingHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="spellingExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßŸÜÿ™ÿ∏ÿßŸÖ (ŸÖŸÜ 10)</label>
            <input type="number" id="spellingAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <!-- ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ® -->
      <div class="behavior-section">
        <div class="section-title">
          <span>üé≠</span>
          <span>ÿ™ŸÇŸäŸäŸÖ ÿ¢ÿØÿßÿ® ÿßŸÑÿ∑ÿßŸÑÿ® ŸÅŸä ÿßŸÑŸÅÿµŸÑ</span>
        </div>
        <div class="behavior-options">
          <label class="behavior-option excellent">
            <input type="radio" name="behavior" value="excellent">
            <div>‚≠ê ŸÖŸÖÿ™ÿßÿ≤</div>
            <small>ÿ≥ŸÑŸàŸÉ ŸÖÿ´ÿßŸÑŸä ŸàŸÖÿ™ŸÖŸäÿ≤</small>
          </label>
          <label class="behavior-option good">
            <input type="radio" name="behavior" value="good">
            <div>üëç ÿ¨ŸäÿØ</div>
            <small>ÿ≥ŸÑŸàŸÉ ÿ¨ŸäÿØ ŸàŸÖŸÇÿ®ŸàŸÑ</small>
          </label>
          <label class="behavior-option needs-improvement">
            <input type="radio" name="behavior" value="needs-improvement">
            <div>üí™ ŸÖÿ≠ÿ™ÿßÿ¨ Ÿäÿ¥ÿØ ÿ≠ŸäŸÑŸá</div>
            <small>Ÿäÿ≠ÿ™ÿßÿ¨ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≥ŸÑŸàŸÉ</small>
          </label>
        </div>
      </div>

      <div class="attendance-section">
        <div class="section-title">
          <span>üìÖ</span>
          <span>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖ</span>
        </div>
        <div class="form-group">
          <select id="attendanceStatus">
            <option value="">ÿßÿÆÿ™ÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ±</option>
            <option value="present">‚úÖ ÿ≠ÿßÿ∂ÿ±</option>
            <option value="absent">‚ùå ÿ∫ÿßÿ¶ÿ®</option>
            <option value="late">‚è∞ ŸÖÿ™ÿ£ÿÆÿ±</option>
          </select>
        </div>
      </div>

      <div class="homework-section">
        <div class="section-title">
          <span>üìù</span>
          <span>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿßŸÑÿ© ÿßŸÑŸàÿßÿ¨ÿ®</span>
        </div>
        <div class="form-group">
          <select id="homeworkStatus">
            <option value="">ÿßÿÆÿ™ÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑŸàÿßÿ¨ÿ®</option>
            <option value="completed">‚úÖ ŸÖŸÉÿ™ŸÖŸÑ ŸàŸÖŸÖŸäÿ≤</option>
            <option value="incomplete">‚ö†Ô∏è ŸÖŸÉÿ™ŸÖŸÑ ÿ¨ÿ≤ÿ¶ŸäÿßŸã</option>
            <option value="not_submitted">‚ùå ŸÑŸÖ ŸäŸèÿ≥ŸÑŸÖ</option>
          </select>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-success" id="saveEvaluation">üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>
        <button class="btn" id="cancelEvaluate">ÿ•ŸÑÿ∫ÿßÿ°</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // ŸÖŸÅÿ™ÿßÿ≠ localStorage
      const STORAGE_KEY = 'studentsTrackingSystem';
      
      // ÿπŸÜÿßÿµÿ± ÿßŸÑŸÄ DOM
      const btnAdd = document.getElementById('btnAdd');
      const addModal = document.getElementById('addModal');
      const evaluateModal = document.getElementById('evaluateModal');
      const searchInput = document.getElementById('searchInput');
      const studentsGrid = document.getElementById('studentsGrid');
      
      // ÿπŸÜÿßÿµÿ± ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©
      const studentName = document.getElementById('studentName');
      const studentGrade = document.getElementById('studentGrade');
      const photoInput = document.getElementById('photoInput');
      const photoPreview = document.getElementById('photoPreview');
      const saveStudent = document.getElementById('saveStudent');
      const cancelAdd = document.getElementById('cancelAdd');
      
      // ÿπŸÜÿßÿµÿ± ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
      const currentStudentName = document.getElementById('currentStudentName');
      
      // ÿπŸÜÿßÿµÿ± ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ
      const religionHomework = document.getElementById('religionHomework');
      const religionExams = document.getElementById('religionExams');
      const religionAttendance = document.getElementById('religionAttendance');
      
      const readingHomework = document.getElementById('readingHomework');
      const readingExams = document.getElementById('readingExams');
      const readingAttendanceEval = document.getElementById('readingAttendance');
      
      const spellingHomework = document.getElementById('spellingHomework');
      const spellingExams = document.getElementById('spellingExams');
      const spellingAttendanceEval = document.getElementById('spellingAttendance');
      
      const attendanceStatus = document.getElementById('attendanceStatus');
      const homeworkStatus = document.getElementById('homeworkStatus');
      const saveEvaluation = document.getElementById('saveEvaluation');
      const cancelEvaluate = document.getElementById('cancelEvaluate');

      let students = [];
      let currentStudentId = null;
      let currentPhoto = null;

      // ÿØÿßŸÑÿ© Debounce ŸÑŸÑÿ®ÿ≠ÿ´
      function debounce(fn, delay=300){
        let timer;
        return (...args) => {
          clearTimeout(timer);
          timer = setTimeout(()=> fn(...args), delay);
        };
      }

      // ŸÖÿπÿßŸÑÿ¨ ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©
      photoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            currentPhoto = e.target.result;
            photoPreview.innerHTML = `<img src="${currentPhoto}" alt="ÿµŸàÿ±ÿ© ÿßŸÑÿ∑ÿßŸÑÿ®">`;
          };
          reader.readAsDataURL(file);
        }
      });

      // ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿØÿßŸÑ
      function openModal(modal){
        modal.setAttribute('aria-hidden','false');
        const firstInput = modal.querySelector('input, select, button');
        if(firstInput) firstInput.focus();
      }
      function closeModal(modal){
        modal.setAttribute('aria-hidden','true');
        clearForm();
      }

      // ŸÖÿ≥ÿ≠ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
      function clearForm() {
        studentName.value = '';
        studentGrade.value = '';
        photoPreview.innerHTML = 'üì∑';
        currentPhoto = null;
        
        // ŸÖÿ≥ÿ≠ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ
        religionHomework.value = '';
        religionExams.value = '';
        religionAttendance.value = '';
        readingHomework.value = '';
        readingExams.value = '';
        readingAttendanceEval.value = '';
        spellingHomework.value = '';
        spellingExams.value = '';
        spellingAttendanceEval.value = '';
        
        // ŸÖÿ≥ÿ≠ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ®
        document.querySelectorAll('input[name="behavior"]').forEach(input => {
          input.checked = false;
        });
        
        attendanceStatus.value = '';
        homeworkStatus.value = '';
        currentStudentId = null;
      }

      // ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä localStorage
      function saveData(){
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
          console.log('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
        } catch (error) {
          console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
          alert('‚ö†Ô∏è ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. ŸÇÿØ ÿ™ŸÉŸàŸÜ ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ŸÖŸÖÿ™ŸÑÿ¶ÿ©.');
        }
      }

      // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ localStorage
      function loadData(){
        try {
          const data = localStorage.getItem(STORAGE_KEY);
          students = data ? JSON.parse(data) : [];
          console.log('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠ÿå ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®:', students.length);
        } catch (error) {
          console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
          students = [];
          alert('‚ö†Ô∏è ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©. ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ®ÿØÿ° ÿ®ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ŸÅÿßÿ±ÿ∫ÿ©.');
        }
      }

      // ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ (ŸÑŸÑÿµŸäÿßŸÜÿ©)
      function clearAllData() {
        if (confirm('‚ö†Ô∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®ÿü Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá!')) {
          localStorage.removeItem(STORAGE_KEY);
          students = [];
          render();
          alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
        }
      }

      // ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÉŸÄ JSON
      function exportData() {
        const dataStr = JSON.stringify(students, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `students_data_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
      }

      // ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ
      saveStudent.addEventListener('click', ()=>{
        const name = studentName.value.trim();
        const grade = studentGrade.value;
        
        if(!name || !grade) {
          alert('‚ö†Ô∏è Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
          return;
        }

        const student = {
          id: Date.now() + Math.random(),
          name, grade,
          photo: currentPhoto,
          grades: {
            ÿßŸÑÿØŸäŸÜ: { homework: 0, exams: 0, attendance: 0 },
            ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: { homework: 0, exams: 0, attendance: 0 },
            ÿßŸÑÿ•ŸÖŸÑÿßÿ°: { homework: 0, exams: 0, attendance: 0 }
          },
          behavior: '',
          attendance: [],
          homework: [],
          createdAt: new Date().toISOString(),
          lastUpdated: new Date().toISOString()
        };

        students.push(student);
        saveData();
        render();
        closeModal(addModal);
        alert('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ∑ÿßŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠!');
      });

      // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
      function evaluateStudent(studentId) {
        const student = students.find(s => s.id == studentId);
        if (!student) return;
        
        currentStudentId = studentId;
        currentStudentName.textContent = `${student.name} - ${student.grade}`;
        
        // ÿπÿ±ÿ∂ ÿßŸÑÿØÿ±ÿ¨ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
        const grades = student.grades;
        religionHomework.value = grades.ÿßŸÑÿØŸäŸÜ?.homework || '';
        religionExams.value = grades.ÿßŸÑÿØŸäŸÜ?.exams || '';
        religionAttendance.value = grades.ÿßŸÑÿØŸäŸÜ?.attendance || '';
        
        readingHomework.value = grades.ÿßŸÑŸÇÿ±ÿßÿ°ÿ©?.homework || '';
        readingExams.value = grades.ÿßŸÑŸÇÿ±ÿßÿ°ÿ©?.exams || '';
        readingAttendanceEval.value = grades.ÿßŸÑŸÇÿ±ÿßÿ°ÿ©?.attendance || '';
        
        spellingHomework.value = grades.ÿßŸÑÿ•ŸÖŸÑÿßÿ°?.homework || '';
        spellingExams.value = grades.ÿßŸÑÿ•ŸÖŸÑÿßÿ°?.exams || '';
        spellingAttendanceEval.value = grades.ÿßŸÑÿ•ŸÖŸÑÿßÿ°?.attendance || '';
        
        // ÿπÿ±ÿ∂ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ® ÿßŸÑÿ≠ÿßŸÑŸä
        if (student.behavior) {
          const behaviorInput = document.querySelector
// ÿπÿ±ÿ∂ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ® ÿßŸÑÿ≠ÿßŸÑŸä
        if (student.behavior) {
          const behaviorInput = document.querySelector(`input[name="behavior"][value="${student.behavior}"]`);
          if (behaviorInput) behaviorInput.checked = true;
        }
        
        openModal(evaluateModal);
      }

      // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
      saveEvaluation.addEventListener('click', ()=>{
        if(!currentStudentId) return;
        
        const studentIndex = students.findIndex(s => s.id == currentStudentId);
        if(studentIndex === -1) return;
        
        // ÿ≠ŸÅÿ∏ ÿØÿ±ÿ¨ÿßÿ™ ÿßŸÑŸÖŸàÿßÿØ
        students[studentIndex].grades = {
          ÿßŸÑÿØŸäŸÜ: {
            homework: parseInt(religionHomework.value) || 0,
            exams: parseInt(religionExams.value) || 0,
            attendance: parseInt(religionAttendance.value) || 0
          },
          ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: {
            homework: parseInt(readingHomework.value) || 0,
            exams: parseInt(readingExams.value) || 0,
            attendance: parseInt(readingAttendanceEval.value) || 0
          },
          ÿßŸÑÿ•ŸÖŸÑÿßÿ°: {
            homework: parseInt(spellingHomework.value) || 0,
            exams: parseInt(spellingExams.value) || 0,
            attendance: parseInt(spellingAttendanceEval.value) || 0
          }
        };
        
        // ÿ≠ŸÅÿ∏ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ®
        const behaviorRadio = document.querySelector('input[name="behavior"]:checked');
        if (behaviorRadio) {
          students[studentIndex].behavior = behaviorRadio.value;
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖŸä
        if(attendanceStatus.value) {
          const today = new Date().toISOString().split('T')[0];
          const existingAttendance = students[studentIndex].attendance.find(a => a.date === today);
          if(existingAttendance) {
            existingAttendance.status = attendanceStatus.value;
          } else {
            students[studentIndex].attendance.push({
              date: today,
              status: attendanceStatus.value
            });
          }
        }
        
        // ÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑŸàÿßÿ¨ÿ®
        if(homeworkStatus.value) {
          const today = new Date().toISOString().split('T')[0];
          const existingHomework = students[studentIndex].homework.find(h => h.date === today);
          if(existingHomework) {
            existingHomework.status = homeworkStatus.value;
          } else {
            students[studentIndex].homework.push({
              date: today,
              status: homeworkStatus.value
            });
          }
        }
        
        students[studentIndex].lastUpdated = new Date().toISOString();
        
        saveData();
        render();
        closeModal(evaluateModal);
        alert('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇŸäŸäŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!');
      });

      // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿπÿßŸÖ ŸÑŸÑÿ∑ÿßŸÑÿ®
      function calculateOverallGrade(student) {
        const grades = student.grades;
        let totalPoints = 0;
        let totalSubjects = 0;
        
        Object.values(grades).forEach(subject => {
          if (subject.homework || subject.exams || subject.attendance) {
            totalPoints += (subject.homework + subject.exams + subject.attendance);
            totalSubjects++;
          }
        });
        
        return totalSubjects > 0 ? Math.round(totalPoints / totalSubjects) : 0;
      }

      // ÿ≠ÿ≥ÿßÿ® ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ≠ÿ∂Ÿàÿ±
      function calculateAttendanceStats(student) {
        const attendance = student.attendance || [];
        const total = attendance.length;
        const present = attendance.filter(a => a.status === 'present').length;
        const percentage = total > 0 ? Math.round((present / total) * 100) : 100;
        return { total, present, percentage };
      }

      // ÿ≠ÿ≥ÿßÿ® ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™
      function calculateHomeworkStats(student) {
        const homework = student.homework || [];
        const total = homework.length;
        const completed = homework.filter(h => h.status === 'completed').length;
        const percentage = total > 0 ? Math.round((completed / total) * 100) : 100;
        return { total, completed, percentage };
      }

      // ÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ¢ÿØÿßÿ®
      function getBehaviorClass(behavior) {
        switch(behavior) {
          case 'excellent': return 'behavior-excellent';
          case 'good': return 'behavior-good';
          case 'needs-improvement': return 'behavior-needs-improvement';
          default: return '';
        }
      }

      function getBehaviorText(behavior) {
        switch(behavior) {
          case 'excellent': return '‚≠ê ŸÖŸÖÿ™ÿßÿ≤';
          case 'good': return 'üëç ÿ¨ŸäÿØ';
          case 'needs-improvement': return 'üí™ ŸÖÿ≠ÿ™ÿßÿ¨ Ÿäÿ¥ÿØ ÿ≠ŸäŸÑŸá';
          default: return '‚ö™ ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ™ŸÇŸäŸäŸÖ';
        }
      }

      // ÿ≠ÿ∞ŸÅ ÿ∑ÿßŸÑÿ®
      function deleteStudent(studentId) {
        if(confirm('‚ö†Ô∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ∑ÿßŸÑÿ®ÿü')) {
          students = students.filter(s => s.id != studentId);
          saveData();
          render();
          alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ÿßŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠');
        }
      }

      // ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿßÿ®
      function render(filteredStudents = null) {
        const studentsToShow = filteredStudents || students;
        
        if(studentsToShow.length === 0) {
          studentsGrid.innerHTML = `
            <div class="empty-state">
              <div class="icon">üë•</div>
              <p>ŸÑÿß ŸäŸàÿ¨ÿØ ÿ∑ŸÑÿßÿ® ŸÑŸÑÿπÿ±ÿ∂</p>
              ${!filteredStudents ? '<p>ÿßÿ®ÿØÿ£ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ</p>' : '<p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÑŸÑÿ®ÿ≠ÿ´</p>'}
            </div>
          `;
          return;
        }

        studentsGrid.innerHTML = studentsToShow.map(student => {
          const overallGrade = calculateOverallGrade(student);
          const attendanceStats = calculateAttendanceStats(student);
          const homeworkStats = calculateHomeworkStats(student);
          const behaviorClass = getBehaviorClass(student.behavior);
          const behaviorText = getBehaviorText(student.behavior);
          
          return `
            <div class="student-card" onclick="evaluateStudent(${student.id})">
              <div class="student-photo">
                ${student.photo ? `<img src="${student.photo}" alt="${student.name}">` : 'üë§'}
              </div>
              <div class="student-info">
                <h3>${student.name}</h3>
                <div class="grade">${student.grade}</div>
                <div class="behavior-indicator ${behaviorClass}">
                  ${behaviorText}
                </div>
                <div class="student-stats">
                  <div class="stat">
                    <span class="stat-value">${overallGrade}</span>
                    <div class="stat-label">ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿπÿßŸÖ</div>
                  </div>
                  <div class="stat">
                    <span class="stat-value">${attendanceStats.percentage}%</span>
                    <div class="stat-label">ÿßŸÑÿ≠ÿ∂Ÿàÿ±</div>
                  </div>
                  <div class="stat">
                    <span class="stat-value">${homeworkStats.percentage}%</span>
                    <div class="stat-label">ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™</div>
                  </div>
                </div>
                <div class="quick-actions" onclick="event.stopPropagation()">
                  <button class="action-btn btn-evaluate" onclick="evaluateStudent(${student.id})">ÿ™ŸÇŸäŸäŸÖ</button>
                  <button class="action-btn btn-danger" onclick="deleteStudent(${student.id})" style="background:#ff3b30;">ÿ≠ÿ∞ŸÅ</button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      // ÿßŸÑÿ®ÿ≠ÿ´
      const debouncedSearch = debounce((query) => {
        if(!query.trim()) {
          render();
          return;
        }
        
        const filtered = students.filter(student => 
          student.name.includes(query) || 
          student.grade.includes(query)
        );
        render(filtered);
      });

      // ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
      btnAdd.addEventListener('click', () => openModal(addModal));
      cancelAdd.addEventListener('click', () => closeModal(addModal));
      cancelEvaluate.addEventListener('click', () => closeModal(evaluateModal));
      
      searchInput.addEventListener('input', (e) => {
        debouncedSearch(e.target.value);
      });

      // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ ÿ®ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ X ÿ£Ÿà ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÖŸàÿØÿßŸÑ
      document.addEventListener('click', (e) => {
        if(e.target.classList.contains('close')) {
          const modal = e.target.closest('.modal');
          closeModal(modal);
        }
        if(e.target.classList.contains('modal')) {
          closeModal(e.target);
        }
      });

      // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ ÿ®ŸÖŸÅÿ™ÿßÿ≠ Escape
      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') {
          const openModal = document.querySelector('.modal[aria-hidden="false"]');
          if(openModal) closeModal(openModal);
        }
      });

      // ÿ¨ÿπŸÑ deleteStudent Ÿà evaluateStudent ŸÖÿ™ÿßÿ≠ÿ™ÿßŸÜ ÿπÿßŸÑŸÖŸäÿßŸã
      window.deleteStudent = deleteStudent;
      window.evaluateStudent = evaluateStudent;

      // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
      loadData();
      render();

      // ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿ≤ÿ±ÿßÿ± ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ•ÿØÿßÿ±ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ©)
      const headerControls = document.querySelector('.controls');
      const adminButtons = `
        <button class="btn btn-danger" onclick="clearAllData()" style="background:#ff3b30; margin-left: 10px;">
          üóëÔ∏è ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        </button>
        <button class="btn" onclick="exportData()" style="background:#34c759;">
          üì§ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        </button>
      `;
      
      // ÿ•ÿ∂ÿßŸÅÿ© ÿØŸàÿßŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ© ŸÑŸÑŸÜÿ∑ÿßŸÇ ÿßŸÑÿπÿßŸÖ
      window.clearAllData = clearAllData;
      window.exportData = exportData;
      
      // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä - ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ¨ÿ≤ÿ° ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ±ŸäÿØ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ©)
      // headerControls.innerHTML += adminButtons;

      console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ∏ÿßŸÖ ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠');
    })();
  </script>
</body>
</html>
