<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</title>
  <style>
    /* =================== RESET & BASE =================== */
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height:100vh; padding:20px; color:#1d1d1f;
    }
    a, button { font-family: inherit; }

    /* =================== LAYOUT =================== */
    .container {
      max-width:1400px; margin: auto;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius:20px; padding:30px;
      box-shadow:0 10px 40px rgba(0,0,0,0.1);
    }
    .header { text-align:center; margin-bottom:40px; }
    .header h1 { font-size:2.5rem; font-weight:600; color:#1d1d1f; }
    .header p { color:#86868b; font-size:1.2rem; margin-top:10px; }

    .controls {
      display:flex; gap:15px; flex-wrap:wrap;
      justify-content: space-between; margin-bottom:30px;
      align-items: center;
    }
    .search-box {
      flex:1; max-width:350px;
      padding:15px 20px; border:2px solid #e5e5e7;
      border-radius:12px; font-size:16px;
      transition:border-color .3s;
    }
    .search-box:focus { outline:none; border-color:#007aff; }

    .students-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(320px,1fr));
      gap:25px; margin-bottom:30px;
    }

    .student-card {
      background:white; border-radius:16px; padding:25px;
      box-shadow:0 4px 20px rgba(0,0,0,0.08);
      transition:all .3s; cursor:pointer; border:2px solid transparent;
      position: relative;
    }
    .student-card:hover {
      transform:translateY(-3px);
      box-shadow:0 8px 30px rgba(0,0,0,0.15);
      border-color:#007aff;
    }

    .student-photo {
      width:70px; height:70px; border-radius:50%;
      margin:0 auto 15px; background:#f0f0f0;
      display:flex; align-items:center; justify-content:center;
      font-size:1.8rem; color:#666; overflow:hidden;
      border: 3px solid #e5e5e7;
    }
    .student-photo img { width:100%; height:100%; object-fit:cover; }

    .student-info h3 { 
      text-align:center; margin-bottom:8px; font-size:1.4rem; 
      color:#1d1d1f;
    }
    .student-info .grade { 
      text-align:center; color:#007aff; margin-bottom:15px; 
      font-weight:500; font-size:1rem;
    }

    /* Ø£Ø¯Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ */
    .behavior-indicator {
      text-align: center; margin-bottom: 15px;
      padding: 8px; border-radius: 8px; font-size: 0.9rem; font-weight: 500;
    }
    .behavior-excellent { background: #d4edda; color: #155724; }
    .behavior-good { background: #fff3cd; color: #856404; }
    .behavior-needs-improvement { background: #f8d7da; color: #721c24; }

    .student-stats { 
      display:grid; grid-template-columns: 1fr 1fr 1fr; 
      gap:10px; margin-bottom:15px;
    }
    .stat { 
      text-align:center; padding:8px; background:#f8f9fa; 
      border-radius:8px;
    }
    .stat-value { 
      font-size:1.1rem; font-weight:600; color:#007aff; 
      display:block;
    }
    .stat-label { 
      font-size:.7rem; color:#86868b; margin-top:2px;
    }

    .quick-actions {
      display:flex; gap:8px; justify-content:center;
    }
    .action-btn {
      padding:8px 16px; border:none; border-radius:20px;
      font-size:12px; font-weight:500; cursor:pointer;
      transition:all .3s;
    }
    .btn-evaluate {
      background:#007aff; color:white;
    }
    .btn-evaluate:hover {
      background:#0056cc; transform:translateY(-1px);
    }

    .btn {
      background:linear-gradient(135deg,#007aff,#0056cc);
      color:#fff; border:none;
      padding:15px 30px; border-radius:12px;
      font-size:16px; font-weight:500; cursor:pointer;
      transition:all .3s; box-shadow:0 4px 15px rgba(0,122,255,0.3);
    }
    .btn:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,122,255,0.4); }
    .btn-success {
      background:linear-gradient(135deg,#34c759,#28a745);
      box-shadow:0 4px 15px rgba(52,199,89,0.3);
    }
    .btn-danger {
      background:linear-gradient(135deg,#ff3b30,#dc3545);
      box-shadow:0 4px 15px rgba(255,59,48,0.3);
    }

    /* =================== MODAL =================== */
    .modal {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,0.6); backdrop-filter:blur(10px);
      align-items:center; justify-content:center; z-index:1000;
    }
    .modal[aria-hidden="false"] { display:flex; }
    .modal-content {
      background:white; border-radius:20px; padding:35px;
      width:90%; max-width:700px; max-height:90vh; overflow-y:auto;
      position:relative; outline:none;
    }
    .close {
      position:absolute; top:15px; right:20px;
      font-size:28px; cursor:pointer; color:#86868b;
    }
    .close:hover { color:#1d1d1f; }

    .form-row {
      display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:25px;
    }
    .form-group { margin-bottom:25px; }
    .form-group label { 
      display:block; margin-bottom:10px; font-weight:600; 
      color:#1d1d1f; font-size:14px;
    }
    .form-group input, .form-group select {
      width:100%; padding:15px 18px;
      border:2px solid #e5e5e7; border-radius:12px;
      font-size:16px; transition:border-color .3s;
    }
    .form-group input:focus, .form-group select:focus { 
      outline:none; border-color:#007aff; 
    }

    /* Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© */
    .photo-upload {
      text-align: center; margin-bottom: 25px;
    }
    .photo-preview {
      width: 120px; height: 120px; border-radius: 50%;
      margin: 0 auto 15px; background: #f0f0f0;
      display: flex; align-items: center; justify-content: center;
      font-size: 3rem; color: #666; overflow: hidden;
      border: 3px dashed #e5e5e7; cursor: pointer;
      transition: all 0.3s;
    }
    .photo-preview:hover { border-color: #007aff; }
    .photo-preview img { width: 100%; height: 100%; object-fit: cover; }
    .photo-input { display: none; }
    .photo-label {
      display: inline-block; padding: 10px 20px;
      background: #f8f9fa; border: 2px solid #e5e5e7;
      border-radius: 8px; cursor: pointer; transition: all 0.3s;
    }
    .photo-label:hover { background: #007aff; color: white; }

    .grade-section {
      background:#f8f9fa; padding:25px; border-radius:12px;
      margin-bottom:25px;
    }
    .grade-section h4 {
      margin-bottom:20px; color:#1d1d1f; text-align:center;
      font-size:1.1rem;
    }

    /* ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ø¯ */
    .subject-evaluation {
      background: white; border: 2px solid #e5e5e7;
      border-radius: 12px; padding: 20px; margin-bottom: 20px;
    }
    .subject-title {
      font-weight: 600; margin-bottom: 15px; color: #1d1d1f;
      font-size: 1.1rem; text-align: center;
    }
    .evaluation-grid {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 15px; margin-bottom: 15px;
    }
    .evaluation-item label {
      font-size: 0.9rem; margin-bottom: 5px;
    }

    .attendance-section, .homework-section {
      background:#fff; border:2px solid #e5e5e7; 
      padding:20px; border-radius:12px; margin-bottom:20px;
    }
    .section-title {
      font-weight:600; margin-bottom:15px; color:#1d1d1f;
      display:flex; align-items:center; gap:8px;
    }

    /* ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ø¯Ø§Ø¨ */
    .behavior-section {
      background: #f8f9fa; border: 2px solid #e5e5e7;
      border-radius: 12px; padding: 20px; margin-bottom: 20px;
    }
    .behavior-options {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 15px; margin-top: 15px;
    }
    .behavior-option {
      padding: 15px; border: 2px solid #e5e5e7;
      border-radius: 10px; text-align: center; cursor: pointer;
      transition: all 0.3s; font-weight: 500;
    }
    .behavior-option input[type="radio"] { display: none; }
    .behavior-option.excellent { border-color: #28a745; background: #d4edda; }
    .behavior-option.good { border-color: #ffc107; background: #fff3cd; }
    .behavior-option.needs-improvement { border-color: #dc3545; background: #f8d7da; }
    .behavior-option:hover { transform: translateY(-2px); }
    .behavior-option input:checked + .behavior-option {
      transform: scale(1.05);
    }

    .modal-actions {
      display:flex; gap:15px; justify-content:center; margin-top:30px;
    }

    .empty-state {
      text-align:center; color:#86868b; font-size:1.2rem; 
      grid-column:1/-1; padding:60px 20px;
    }
    .empty-state .icon { font-size:3rem; margin-bottom:20px; }

    @media(max-width:768px) {
      .controls { flex-direction:column; align-items:stretch; }
      .search-box { width:100%; }
      .students-grid { grid-template-columns:1fr; }
      .form-row { grid-template-columns:1fr; }
      .student-stats { grid-template-columns:1fr; }
      .evaluation-grid { grid-template-columns: 1fr; }
      .behavior-options { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Ù…ØªØ§Ø¨Ø¹Ù‡ Ù…Ù‡Ø±Ø§Øª Ù„ØºØªÙŠ Ù„Ù„ØµÙ Ø§Ù„Ø§ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ </h1>
      <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ ÙˆØ§Ù„Ø¢Ø¯Ø§Ø¨</p>
    </div>

    <div class="controls">
      <button class="btn" id="btnAdd">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨...">
    </div>

    <div class="students-grid" id="studentsGrid"></div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ -->
  <div id="addModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" tabindex="-1">
      <button class="close" aria-label="Ø¥ØºÙ„Ø§Ù‚">&times;</button>
      <h2>â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>

      <div class="photo-upload">
        <div class="photo-preview" id="photoPreview" onclick="document.getElementById('photoInput').click()">
          ğŸ“·
        </div>
        <input type="file" id="photoInput" class="photo-input" accept="image/*">
        <label for="photoInput" class="photo-label">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</label>
      </div>

      <div class="form-group">
        <label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ *</label>
        <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required>
      </div>

      <div class="form-group">
        <label for="studentGrade">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ *</label>
        <select id="studentGrade" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
          <option>Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
        </select>
      </div>

      <div class="modal-actions">
        <button class="btn btn-success" id="saveStudent">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
        <button class="btn" id="cancelAdd">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø·Ø§Ù„Ø¨ -->
  <div id="evaluateModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" tabindex="-1">
      <button class="close" aria-label="Ø¥ØºÙ„Ø§Ù‚">&times;</button>
      <h2>ğŸ“ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
      <h3 id="currentStudentName" style="text-align:center; color:#007aff; margin-bottom:25px;"></h3>

      <!-- ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ø¯ -->
      <div class="subject-evaluation">
        <div class="subject-title">ğŸ•Œ Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯ÙŠÙ†</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª (Ù…Ù† 10)</label>
            <input type="number" id="religionHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Ù…Ù† 10)</label>
            <input type="number" id="religionExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>Ø§Ù„Ø§Ù†ØªØ¸Ø§Ù… (Ù…Ù† 10)</label>
            <input type="number" id="religionAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <div class="subject-evaluation">
        <div class="subject-title">ğŸ“– Ù…Ø§Ø¯Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª (Ù…Ù† 10)</label>
            <input type="number" id="readingHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Ù…Ù† 10)</label>
            <input type="number" id="readingExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>Ø§Ù„Ø§Ù†ØªØ¸Ø§Ù… (Ù…Ù† 10)</label>
            <input type="number" id="readingAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <div class="subject-evaluation">
        <div class="subject-title">âœï¸ Ù…Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª (Ù…Ù† 10)</label>
            <input type="number" id="spellingHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Ù…Ù† 10)</label>
            <input type="number" id="spellingExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>Ø§Ù„Ø§Ù†ØªØ¸Ø§Ù… (Ù…Ù† 10)</label>
            <input type="number" id="spellingAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <!-- ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ø¯Ø§Ø¨ -->
      <div class="behavior-section">
        <div class="section-title">
          <span>ğŸ­</span>
          <span>ØªÙ‚ÙŠÙŠÙ… Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„ÙØµÙ„</span>
        </div>
        <div class="behavior-options">
          <label class="behavior-option excellent">
            <input type="radio" name="behavior" value="excellent">
            <div>â­ Ù…Ù…ØªØ§Ø²</div>
            <small>Ø³Ù„ÙˆÙƒ Ù…Ø«Ø§Ù„ÙŠ ÙˆÙ…ØªÙ…ÙŠØ²</small>
          </label>
          <label class="behavior-option good">
            <input type="radio" name="behavior" value="good">
            <div>ğŸ‘ Ø¬ÙŠØ¯</div>
            <small>Ø³Ù„ÙˆÙƒ Ø¬ÙŠØ¯ ÙˆÙ…Ù‚Ø¨ÙˆÙ„</small>
          </label>
          <label class="behavior-option needs-improvement">
            <input type="radio" name="behavior" value="needs-improvement">
            <div>ğŸ’ª Ù…Ø­ØªØ§Ø¬ ÙŠØ´Ø¯ Ø­ÙŠÙ„Ù‡</div>
            <small>ÙŠØ­ØªØ§Ø¬ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø³Ù„ÙˆÙƒ</small>
          </label>
        </div>
      </div>

      <div class="attendance-section">
        <div class="section-title">
          <span>ğŸ“…</span>
          <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</span>
        </div>
        <div class="form-group">
          <select id="attendanceStatus">
            <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</option>
            <option value="present">âœ… Ø­Ø§Ø¶Ø±</option>
            <option value="absent">âŒ ØºØ§Ø¦Ø¨</option>
            <option value="late">â° Ù…ØªØ£Ø®Ø±</option>
          </select>
        </div>
      </div>

      <div class="homework-section">
        <div class="section-title">
          <span>ğŸ“</span>
          <span>ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨</span>
        </div>
        <div class="form-group">
          <select id="homeworkStatus">
            <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨</option>
            <option value="completed">âœ… Ù…ÙƒØªÙ…Ù„ ÙˆÙ…Ù…ÙŠØ²</option>
            <option value="incomplete">âš ï¸ Ù…ÙƒØªÙ…Ù„ Ø¬Ø²Ø¦ÙŠØ§Ù‹</option>
            <option value="not_submitted">âŒ Ù„Ù… ÙŠÙØ³Ù„Ù…</option>
          </select>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-success" id="saveEvaluation">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
        <button class="btn" id="cancelEvaluate">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù€ DOM
      const btnAdd = document.getElementById('btnAdd');
      const addModal = document.getElementById('addModal');
      const evaluateModal = document.getElementById('evaluateModal');
      const searchInput = document.getElementById('searchInput');
      const studentsGrid = document.getElementById('studentsGrid');
      
      // Ø¹Ù†Ø§ØµØ± Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
      const studentName = document.getElementById('studentName');
      const studentGrade = document.getElementById('studentGrade');
      const photoInput = document.getElementById('photoInput');
      const photoPreview = document.getElementById('photoPreview');
      const saveStudent = document.getElementById('saveStudent');
      const cancelAdd = document.getElementById('cancelAdd');
      
      // Ø¹Ù†Ø§ØµØ± Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      const currentStudentName = document.getElementById('currentStudentName');
      
      // Ø¹Ù†Ø§ØµØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ø¯
      const religionHomework = document.getElementById('religionHomework');
      const religionExams = document.getElementById('religionExams');
      const religionAttendance = document.getElementById('religionAttendance');
      
      const readingHomework = document.getElementById('readingHomework');
      const readingExams = document.getElementById('readingExams');
      const readingAttendanceEval = document.getElementById('readingAttendance');
      
      const spellingHomework = document.getElementById('spellingHomework');
      const spellingExams = document.getElementById('spellingExams');
      const spellingAttendanceEval = document.getElementById('spellingAttendance');
      
      const attendanceStatus = document.getElementById('attendanceStatus');
      const homeworkStatus = document.getElementById('homeworkStatus');
      const saveEvaluation = document.getElementById('saveEvaluation');
      const cancelEvaluate = document.getElementById('cancelEvaluate');

      let students = [];
      let currentStudentId = null;
      let currentPhoto = null;

      // Ø¯Ø§Ù„Ø© Debounce Ù„Ù„Ø¨Ø­Ø«
      function debounce(fn, delay=300){
        let timer;
        return (...args) => {
          clearTimeout(timer);
          timer = setTimeout(()=> fn(...args), delay);
        };
      }

      // Ù…Ø¹Ø§Ù„Ø¬ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
      photoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            currentPhoto = e.target.result;
            photoPreview.innerHTML = `<img src="${currentPhoto}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨">`;
          };
          reader.readAsDataURL(file);
        }
      });

      // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      function openModal(modal){
        modal.setAttribute('aria-hidden','false');
        const firstInput = modal.querySelector('input, select, button');
        if(firstInput) firstInput.focus();
      }
      function closeModal(modal){
        modal.setAttribute('aria-hidden','true');
        clearForm();
      }

      // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
      function clearForm() {
        studentName.value = '';
        studentGrade.value = '';
        photoPreview.innerHTML = 'ğŸ“·';
        currentPhoto = null;
        
        // Ù…Ø³Ø­ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ø¯
        religionHomework.value = '';
        religionExams.value = '';
        religionAttendance.value = '';
        readingHomework.value = '';
        readingExams.value = '';
        readingAttendanceEval.value = '';
        spellingHomework.value = '';
        spellingExams.value = '';
        spellingAttendanceEval.value = '';
        
        // Ù…Ø³Ø­ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ø¯Ø§Ø¨
        document.querySelectorAll('input[name="behavior"]').forEach(input => {
          input.checked = false;
        });
        
        attendanceStatus.value = '';
        homeworkStatus.value = '';
        currentStudentId = null;
      }

      // Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      function saveData(){
        window.studentsData = JSON.stringify(students);
      }
      function loadData(){
        const data = window.studentsData;
        students = data ? JSON.parse(data) : [];
      }

      // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
      saveStudent.addEventListener('click', ()=>{
        const name = studentName.value.trim();
        const grade = studentGrade.value;
        
        if(!name || !grade) {
          alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
          return;
        }

        const student = {
          id: Date.now() + Math.random(),
          name, grade,
          photo: currentPhoto,
          grades: {
            Ø§Ù„Ø¯ÙŠÙ†: { homework: 0, exams: 0, attendance: 0 },
            Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: { homework: 0, exams: 0, attendance: 0 },
            Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡: { homework: 0, exams: 0, attendance: 0 }
          },
          behavior: '',
          attendance: [],
          homework: [],
          createdAt: new Date().toISOString()
        };

        students.push(student);
        saveData();
        render();
        closeModal(addModal);
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
      });

      // ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      function evaluateStudent(studentId) {
        const student = students.find(s => s.id == studentId);
        if (!student) return;
        
        currentStudentId = studentId;
        currentStudentName.textContent = `${student.name} - ${student.grade}`;
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const grades = student.grades;
        religionHomework.value = grades.Ø§Ù„Ø¯ÙŠÙ†?.homework || '';
        religionExams.value = grades.Ø§Ù„Ø¯ÙŠÙ†?.exams || '';
        religionAttendance.value = grades.Ø§Ù„Ø¯ÙŠÙ†?.attendance || '';
        
        readingHomework.value = grades.Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©?.homework || '';
        readingExams.value = grades.Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©?.exams || '';
        readingAttendanceEval.value = grades.Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©?.attendance || '';
        
        spellingHomework.value = grades.Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡?.homework || '';
        spellingExams.value = grades.Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡?.exams || '';
        spellingAttendanceEval.value = grades.Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡?.attendance || '';
        
        // Ø¹Ø±Ø¶ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
        if (student.behavior) {
          document.querySelector(`input[name="behavior"][value="${student.behavior}"]`).checked = true;
        }
        
        openModal(evaluateModal);
      }

      // Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      saveEvaluation.addEventListener('click', ()=>{
        if (!currentStudentId) return;
        
        const student = students.find(s => s.id == currentStudentId);
        if (!student) return;

        // Ø­ÙØ¸ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¯
        student.grades.Ø§Ù„Ø¯ÙŠÙ† = {
          homework: parseInt(religionHomework.value) || 0,
          exams: parseInt(religionExams.value) || 0,
          attendance: parseInt(religionAttendance.value) || 0
        };
        
        student.grades.Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© = {
          homework: parseInt(readingHomework.value) || 0,
          exams: parseInt(readingExams.value) || 0,
          attendance: parseInt(readingAttendanceEval.value) || 0
        };
        
        student.grades.Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡ = {
          homework: parseInt(spellingHomework.value) || 0,
          exams: parseInt(spellingExams.value) || 0,
          attendance: parseInt(spellingAttendanceEval.value) || 0
        };

        // Ø­ÙØ¸ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ø¯Ø§Ø¨
        const behaviorRadio = document.querySelector('input[name="behavior"]:checked');
        if (behaviorRadio) {
          student.behavior = behaviorRadio.value;
        }

        const today = new Date().toISOString().split('T')[0];

        // Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±
        if (attendanceStatus.value) {
          const existingIndex = student.attendance.findIndex(a => a.date === today);
          const record = {
            date: today,
            status: attendanceStatus.value,
            present: attendanceStatus.value === 'present' || attendanceStatus.value === 'late'
          };
          
          if (existingIndex >= 0) {
            student.attendance[existingIndex] = record;
          } else {
            student.attendance.push(record);
          }
        }

        // Ø­ÙØ¸ Ø§Ù„ÙˆØ§Ø¬Ø¨
        if (homeworkStatus.value) {
          const existingIndex = student.homework.findIndex(h => h.date === today);
          const record = {
            date: today,
            status: homeworkStatus.value,
            completed: homeworkStatus.value === 'completed'
          };
          
          if (existingIndex >= 0) {
            student.homework[existingIndex] = record;
          } else {
            student.homework.push(record);
          }
        }

        saveData();
        render();
        closeModal(evaluateModal);
        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!');
      });

      // Ø§Ù„Ø¨Ø­Ø«
      searchInput.addEventListener('input', debounce(e=>{
        render(e.target.value.trim());
      }));

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø·Ø§Ù„Ø¨
      function calculateOverallAverage(grades) {
        let total = 0;
        let count = 0;
        
        Object.values(grades).forEach(subject => {
          if (subject.homework !== undefined && subject.exams !== undefined && subject.attendance !== undefined) {
            total += (subject.homework + subject.exams + subject.attendance);
            count += 3;
          }
        });
        
        return count > 0 ? (total / count).toFixed(1) : 0;
      }

      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ø¯Ø§Ø¨
      function getBehaviorText(behavior) {
        switch(behavior) {
          case 'excellent': return 'Ù…Ù…ØªØ§Ø² â­';
          case 'good': return 'Ø¬ÙŠØ¯ ğŸ‘';
          case 'needs-improvement': return 'Ù…Ø­ØªØ§Ø¬ ÙŠØ´Ø¯ Ø­ÙŠÙ„Ù‡ ğŸ’ª';
          default: return 'Ù„Ù… ÙŠÙÙ‚ÙŠÙ… Ø¨Ø¹Ø¯';
        }
      }

      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙØ¦Ø© CSS Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¢Ø¯Ø§Ø¨
      function getBehaviorClass(behavior) {
        switch(behavior) {
          case 'excellent': return 'behavior-excellent';
          case 'good': return 'behavior-good';
          case 'needs-improvement': return 'behavior-needs-improvement';
          default: return '';
        }
      }

      // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨
      function render(searchTerm = ''){
        studentsGrid.innerHTML = '';
        
        let filteredStudents = students;
        if (searchTerm) {
          filteredStudents = students.filter(s => 
            s.name.includes(searchTerm) || s.grade.includes(searchTerm)
          );
        }

        if (filteredStudents.length === 0) {
          if (searchTerm) {
            studentsGrid.innerHTML = `<div class="empty-state">
              <div class="icon">ğŸ”</div>
              <div>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«: "${searchTerm}"</div>
            </div>`;
          } else {
            studentsGrid.innerHTML = `<div class="empty-state">
              <div class="icon">ğŸ‘¥</div>
              <div>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ†</div>
              <div style="margin-top:10px; font-size:1rem;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯" Ù„Ù„Ø¨Ø¯Ø¡</div>
            </div>`;
          }
          return;
        }

        filteredStudents.forEach(student => {
          const grades = student.grades;
          const average = calculateOverallAverage(grades);
          
          const attendanceRate = student.attendance.length > 0 
            ? Math.round((student.attendance.filter(a => a.present).length / student.attendance.length) * 100)
            : 0;

          const homeworkCount = student.homework.filter(h => h.completed).length;
          
          const behaviorText = getBehaviorText(student.behavior);
          const behaviorClass = getBehaviorClass(student.behavior);

          const card = document.createElement('div');
          card.className = 'student-card';
          card.onclick = () => evaluateStudent(student.id);
          
          const photoHtml = student.photo 
            ? `<img src="${student.photo}" alt="ØµÙˆØ±Ø© ${student.name}">`
            : 'ğŸ‘¤';
          
          card.innerHTML = `
            <div class="student-photo">${photoHtml}</div>
            <div class="student-info">
              <h3>${student.name}</h3>
              <div class="grade">${student.grade}</div>
              <div class="behavior-indicator ${behaviorClass}">
                ${behaviorText}
              </div>
              <div class="student-stats">
                <div class="stat">
                  <span class="stat-value">${average}</span>
                  <div class="stat-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</div>
                </div>
                <div class="stat">
                  <span class="stat-value">${attendanceRate}%</span>
                  <div class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                </div>
                <div class="stat">
                  <span class="stat-value">${homeworkCount}</span>
                  <div class="stat-label">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>
              </div>
              <div class="quick-actions">
                <button class="action-btn btn-evaluate" onclick="event.stopPropagation(); evaluateStudent(${student.id})">
                  ğŸ“ ØªÙ‚ÙŠÙŠÙ… Ø³Ø±ÙŠØ¹
                </button>
              </div>
            </div>
          `;
          
          studentsGrid.appendChild(card);
        });
      }

      // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      btnAdd.onclick = () => openModal(addModal);
      cancelAdd.onclick = () => closeModal(addModal);
      cancelEvaluate.onclick = () => closeModal(evaluateModal);
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡
      [addModal, evaluateModal].forEach(modal => {
        modal.onclick = (e) => {
          if (e.target === modal) closeModal(modal);
        };
        modal.querySelector('.close').onclick = () => closeModal(modal);
      });

      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ù„Ù€ Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (addModal.getAttribute('aria-hidden') === 'false') closeModal(addModal);
          if (evaluateModal.getAttribute('aria-hidden') === 'false') closeModal(evaluateModal);
        }
      });

      // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
      window.evaluateStudent = evaluateStudent;

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      loadData();
      render();
    })();
  </script>
</body>
</html>
