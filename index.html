<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ŸÜÿ∏ÿßŸÖ ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ∑ŸÑÿßÿ®</title>
  <style>
    /* =================== RESET & BASE =================== */
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height:100vh; padding:20px; color:#1d1d1f;
    }
    a, button { font-family: inherit; }

    /* =================== LAYOUT =================== */
    .container {
      max-width:1400px; margin: auto;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius:20px; padding:30px;
      box-shadow:0 10px 40px rgba(0,0,0,0.1);
    }
    .header { text-align:center; margin-bottom:40px; }
    .header h1 { font-size:2.5rem; font-weight:600; color:#1d1d1f; }
    .header p { color:#86868b; font-size:1.2rem; margin-top:10px; }

    .controls {
      display:flex; gap:15px; flex-wrap:wrap;
      justify-content: space-between; margin-bottom:30px;
      align-items: center;
    }
    .search-box {
      flex:1; max-width:350px;
      padding:15px 20px; border:2px solid #e5e5e7;
      border-radius:12px; font-size:16px;
      transition:border-color .3s;
    }
    .search-box:focus { outline:none; border-color:#007aff; }

    .students-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(320px,1fr));
      gap:25px; margin-bottom:30px;
    }

    .student-card {
      background:white; border-radius:16px; padding:25px;
      box-shadow:0 4px 20px rgba(0,0,0,0.08);
      transition:all .3s; cursor:pointer; border:2px solid transparent;
      position: relative;
    }
    .student-card:hover {
      transform:translateY(-3px);
      box-shadow:0 8px 30px rgba(0,0,0,0.15);
      border-color:#007aff;
    }

    .student-photo {
      width:70px; height:70px; border-radius:50%;
      margin:0 auto 15px; background:#f0f0f0;
      display:flex; align-items:center; justify-content:center;
      font-size:1.8rem; color:#666; overflow:hidden;
      border: 3px solid #e5e5e7;
    }
    .student-photo img { width:100%; height:100%; object-fit:cover; }

    .student-info h3 { 
      text-align:center; margin-bottom:8px; font-size:1.4rem; 
      color:#1d1d1f;
    }
    .student-info .grade { 
      text-align:center; color:#007aff; margin-bottom:15px; 
      font-weight:500; font-size:1rem;
    }

    /* ÿ£ÿØÿßÿ® ÿßŸÑÿ∑ÿßŸÑÿ® */
    .behavior-indicator {
      text-align: center; margin-bottom: 15px;
      padding: 8px; border-radius: 8px; font-size: 0.9rem; font-weight: 500;
    }
    .behavior-excellent { background: #d4edda; color: #155724; }
    .behavior-good { background: #fff3cd; color: #856404; }
    .behavior-needs-improvement { background: #f8d7da; color: #721c24; }

    .student-stats { 
      display:grid; grid-template-columns: 1fr 1fr 1fr; 
      gap:10px; margin-bottom:15px;
    }
    .stat { 
      text-align:center; padding:8px; background:#f8f9fa; 
      border-radius:8px;
    }
    .stat-value { 
      font-size:1.1rem; font-weight:600; color:#007aff; 
      display:block;
    }
    .stat-label { 
      font-size:.7rem; color:#86868b; margin-top:2px;
    }

    .quick-actions {
      display:flex; gap:8px; justify-content:center;
    }
    .action-btn {
      padding:8px 16px; border:none; border-radius:20px;
      font-size:12px; font-weight:500; cursor:pointer;
      transition:all .3s;
    }
    .btn-evaluate {
      background:#007aff; color:white;
    }
    .btn-evaluate:hover {
      background:#0056cc; transform:translateY(-1px);
    }

    .btn {
      background:linear-gradient(135deg,#007aff,#0056cc);
      color:#fff; border:none;
      padding:15px 30px; border-radius:12px;
      font-size:16px; font-weight:500; cursor:pointer;
      transition:all .3s; box-shadow:0 4px 15px rgba(0,122,255,0.3);
    }
    .btn:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,122,255,0.4); }
    .btn-success {
      background:linear-gradient(135deg,#34c759,#28a745);
      box-shadow:0 4px 15px rgba(52,199,89,0.3);
    }
    .btn-danger {
      background:linear-gradient(135deg,#ff3b30,#dc3545);
      box-shadow:0 4px 15px rgba(255,59,48,0.3);
    }

    /* =================== MODAL =================== */
    .modal {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,0.6); backdrop-filter:blur(10px);
      align-items:center; justify-content:center; z-index:1000;
    }
    .modal[aria-hidden="false"] { display:flex; }
    .modal-content {
      background:white; border-radius:20px; padding:35px;
      width:90%; max-width:700px; max-height:90vh; overflow-y:auto;
      position:relative; outline:none;
    }
    .close {
      position:absolute; top:15px; right:20px;
      font-size:28px; cursor:pointer; color:#86868b;
    }
    .close:hover { color:#1d1d1f; }

    .form-row {
      display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:25px;
    }
    .form-group { margin-bottom:25px; }
    .form-group label { 
      display:block; margin-bottom:10px; font-weight:600; 
      color:#1d1d1f; font-size:14px;
    }
    .form-group input, .form-group select {
      width:100%; padding:15px 18px;
      border:2px solid #e5e5e7; border-radius:12px;
      font-size:16px; transition:border-color .3s;
    }
    .form-group input:focus, .form-group select:focus { 
      outline:none; border-color:#007aff; 
    }

    /* ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© */
    .photo-upload {
      text-align: center; margin-bottom: 25px;
    }
    .photo-preview {
      width: 120px; height: 120px; border-radius: 50%;
      margin: 0 auto 15px; background: #f0f0f0;
      display: flex; align-items: center; justify-content: center;
      font-size: 3rem; color: #666; overflow: hidden;
      border: 3px dashed #e5e5e7; cursor: pointer;
      transition: all 0.3s;
    }
    .photo-preview:hover { border-color: #007aff; }
    .photo-preview img { width: 100%; height: 100%; object-fit: cover; }
    .photo-input { display: none; }
    .photo-label {
      display: inline-block; padding: 10px 20px;
      background: #f8f9fa; border: 2px solid #e5e5e7;
      border-radius: 8px; cursor: pointer; transition: all 0.3s;
    }
    .photo-label:hover { background: #007aff; color: white; }

    .grade-section {
      background:#f8f9fa; padding:25px; border-radius:12px;
      margin-bottom:25px;
    }
    .grade-section h4 {
      margin-bottom:20px; color:#1d1d1f; text-align:center;
      font-size:1.1rem;
    }

    /* ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ */
    .subject-evaluation {
      background: white; border: 2px solid #e5e5e7;
      border-radius: 12px; padding: 20px; margin-bottom: 20px;
    }
    .subject-title {
      font-weight: 600; margin-bottom: 15px; color: #1d1d1f;
      font-size: 1.1rem; text-align: center;
    }
    .evaluation-grid {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 15px; margin-bottom: 15px;
    }
    .evaluation-item label {
      font-size: 0.9rem; margin-bottom: 5px;
    }

    .attendance-section, .homework-section {
      background:#fff; border:2px solid #e5e5e7; 
      padding:20px; border-radius:12px; margin-bottom:20px;
    }
    .section-title {
      font-weight:600; margin-bottom:15px; color:#1d1d1f;
      display:flex; align-items:center; gap:8px;
    }

    /* ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ® */
    .behavior-section {
      background: #f8f9fa; border: 2px solid #e5e5e7;
      border-radius: 12px; padding: 20px; margin-bottom: 20px;
    }
    .behavior-options {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 15px; margin-top: 15px;
    }
    .behavior-option {
      padding: 15px; border: 2px solid #e5e5e7;
      border-radius: 10px; text-align: center; cursor: pointer;
      transition: all 0.3s; font-weight: 500;
    }
    .behavior-option input[type="radio"] { display: none; }
    .behavior-option.excellent { border-color: #28a745; background: #d4edda; }
    .behavior-option.good { border-color: #ffc107; background: #fff3cd; }
    .behavior-option.needs-improvement { border-color: #dc3545; background: #f8d7da; }
    .behavior-option:hover { transform: translateY(-2px); }
    .behavior-option input:checked + .behavior-option {
      transform: scale(1.05);
    }

    .modal-actions {
      display:flex; gap:15px; justify-content:center; margin-top:30px;
    }

    .empty-state {
      text-align:center; color:#86868b; font-size:1.2rem; 
      grid-column:1/-1; padding:60px 20px;
    }
    .empty-state .icon { font-size:3rem; margin-bottom:20px; }

    @media(max-width:768px) {
      .controls { flex-direction:column; align-items:stretch; }
      .search-box { width:100%; }
      .students-grid { grid-template-columns:1fr; }
      .form-row { grid-template-columns:1fr; }
      .student-stats { grid-template-columns:1fr; }
      .evaluation-grid { grid-template-columns: 1fr; }
      .behavior-options { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ŸÖÿ™ÿßÿ®ÿπŸá ŸÖŸáÿ±ÿßÿ™ ŸÑÿ∫ÿ™Ÿä ŸÑŸÑÿµŸÅ ÿßŸÑÿßŸàŸÑ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä </h1>
      <p>ŸÖÿ™ÿßÿ®ÿπÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ ŸàÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ŸàÿßŸÑÿ¢ÿØÿßÿ®</p>
    </div>

    <div class="controls">
      <button class="btn" id="btnAdd">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ</button>
      <input type="text" id="searchInput" class="search-box" placeholder="üîç ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ∑ÿßŸÑÿ®...">
    </div>

    <div class="students-grid" id="studentsGrid"></div>
  </div>

  <!-- ŸÖŸàÿØÿßŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® -->
  <div id="addModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" tabindex="-1">
      <button class="close" aria-label="ÿ•ÿ∫ŸÑÿßŸÇ">&times;</button>
      <h2>‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ</h2>

      <div class="photo-upload">
        <div class="photo-preview" id="photoPreview" onclick="document.getElementById('photoInput').click()">
          üì∑
        </div>
        <input type="file" id="photoInput" class="photo-input" accept="image/*">
        <label for="photoInput" class="photo-label">ÿßÿÆÿ™ÿ± ÿµŸàÿ±ÿ© ÿßŸÑÿ∑ÿßŸÑÿ®</label>
      </div>

      <div class="form-group">
        <label for="studentName">ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® *</label>
        <input type="text" id="studentName" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ®" required>
      </div>

      <div class="form-group">
        <label for="studentGrade">ÿßŸÑÿµŸÅ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä *</label>
        <select id="studentGrade" required>
          <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ</option>
          <option>ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ±ÿßÿ®ÿπ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿÆÿßŸÖÿ≥ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
          <option>ÿßŸÑÿ≥ÿßÿØÿ≥ ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿä</option>
        </select>
      </div>

      <div class="modal-actions">
        <button class="btn btn-success" id="saveStudent">ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ∑ÿßŸÑÿ®</button>
        <button class="btn" id="cancelAdd">ÿ•ŸÑÿ∫ÿßÿ°</button>
      </div>
    </div>
  </div>

  <!-- ŸÖŸàÿØÿßŸÑ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® -->
  <div id="evaluateModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" tabindex="-1">
      <button class="close" aria-label="ÿ•ÿ∫ŸÑÿßŸÇ">&times;</button>
      <h2>üìù ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ∑ÿßŸÑÿ®</h2>
      <h3 id="currentStudentName" style="text-align:center; color:#007aff; margin-bottom:25px;"></h3>

      <!-- ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ -->
      <div class="subject-evaluation">
        <div class="subject-title">üïå ŸÖÿßÿØÿ© ÿßŸÑÿØŸäŸÜ</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="religionHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="religionExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßŸÜÿ™ÿ∏ÿßŸÖ (ŸÖŸÜ 10)</label>
            <input type="number" id="religionAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <div class="subject-evaluation">
        <div class="subject-title">üìñ ŸÖÿßÿØÿ© ÿßŸÑŸÇÿ±ÿßÿ°ÿ©</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="readingHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="readingExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßŸÜÿ™ÿ∏ÿßŸÖ (ŸÖŸÜ 10)</label>
            <input type="number" id="readingAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <div class="subject-evaluation">
        <div class="subject-title">‚úèÔ∏è ŸÖÿßÿØÿ© ÿßŸÑÿ•ŸÖŸÑÿßÿ°</div>
        <div class="evaluation-grid">
          <div class="evaluation-item">
            <label>ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="spellingHomework" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ (ŸÖŸÜ 10)</label>
            <input type="number" id="spellingExams" min="0" max="10" placeholder="0">
          </div>
          <div class="evaluation-item">
            <label>ÿßŸÑÿßŸÜÿ™ÿ∏ÿßŸÖ (ŸÖŸÜ 10)</label>
            <input type="number" id="spellingAttendance" min="0" max="10" placeholder="0">
          </div>
        </div>
      </div>

      <!-- ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ® -->
      <div class="behavior-section">
        <div class="section-title">
          <span>üé≠</span>
          <span>ÿ™ŸÇŸäŸäŸÖ ÿ¢ÿØÿßÿ® ÿßŸÑÿ∑ÿßŸÑÿ® ŸÅŸä ÿßŸÑŸÅÿµŸÑ</span>
        </div>
        <div class="behavior-options">
          <label class="behavior-option excellent">
            <input type="radio" name="behavior" value="excellent">
            <div>‚≠ê ŸÖŸÖÿ™ÿßÿ≤</div>
            <small>ÿ≥ŸÑŸàŸÉ ŸÖÿ´ÿßŸÑŸä ŸàŸÖÿ™ŸÖŸäÿ≤</small>
          </label>
          <label class="behavior-option good">
            <input type="radio" name="behavior" value="good">
            <div>üëç ÿ¨ŸäÿØ</div>
            <small>ÿ≥ŸÑŸàŸÉ ÿ¨ŸäÿØ ŸàŸÖŸÇÿ®ŸàŸÑ</small>
          </label>
          <label class="behavior-option needs-improvement">
            <input type="radio" name="behavior" value="needs-improvement">
            <div>üí™ ŸÖÿ≠ÿ™ÿßÿ¨ Ÿäÿ¥ÿØ ÿ≠ŸäŸÑŸá</div>
            <small>Ÿäÿ≠ÿ™ÿßÿ¨ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≥ŸÑŸàŸÉ</small>
          </label>
        </div>
      </div>

      <div class="attendance-section">
        <div class="section-title">
          <span>üìÖ</span>
          <span>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖ</span>
        </div>
        <div class="form-group">
          <select id="attendanceStatus">
            <option value="">ÿßÿÆÿ™ÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ±</option>
            <option value="present">‚úÖ ÿ≠ÿßÿ∂ÿ±</option>
            <option value="absent">‚ùå ÿ∫ÿßÿ¶ÿ®</option>
            <option value="late">‚è∞ ŸÖÿ™ÿ£ÿÆÿ±</option>
          </select>
        </div>
      </div>

      <div class="homework-section">
        <div class="section-title">
          <span>üìù</span>
          <span>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿßŸÑÿ© ÿßŸÑŸàÿßÿ¨ÿ®</span>
        </div>
        <div class="form-group">
          <select id="homeworkStatus">
            <option value="">ÿßÿÆÿ™ÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑŸàÿßÿ¨ÿ®</option>
            <option value="completed">‚úÖ ŸÖŸÉÿ™ŸÖŸÑ ŸàŸÖŸÖŸäÿ≤</option>
            <option value="incomplete">‚ö†Ô∏è ŸÖŸÉÿ™ŸÖŸÑ ÿ¨ÿ≤ÿ¶ŸäÿßŸã</option>
            <option value="not_submitted">‚ùå ŸÑŸÖ ŸäŸèÿ≥ŸÑŸÖ</option>
          </select>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-success" id="saveEvaluation">üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>
        <button class="btn" id="cancelEvaluate">ÿ•ŸÑÿ∫ÿßÿ°</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // ÿπŸÜÿßÿµÿ± ÿßŸÑŸÄ DOM
      const btnAdd = document.getElementById('btnAdd');
      const addModal = document.getElementById('addModal');
      const evaluateModal = document.getElementById('evaluateModal');
      const searchInput = document.getElementById('searchInput');
      const studentsGrid = document.getElementById('studentsGrid');
      
      // ÿπŸÜÿßÿµÿ± ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©
      const studentName = document.getElementById('studentName');
      const studentGrade = document.getElementById('studentGrade');
      const photoInput = document.getElementById('photoInput');
      const photoPreview = document.getElementById('photoPreview');
      const saveStudent = document.getElementById('saveStudent');
      const cancelAdd = document.getElementById('cancelAdd');
      
      // ÿπŸÜÿßÿµÿ± ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
      const currentStudentName = document.getElementById('currentStudentName');
      
      // ÿπŸÜÿßÿµÿ± ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ
      const religionHomework = document.getElementById('religionHomework');
      const religionExams = document.getElementById('religionExams');
      const religionAttendance = document.getElementById('religionAttendance');
      
      const readingHomework = document.getElementById('readingHomework');
      const readingExams = document.getElementById('readingExams');
      const readingAttendanceEval = document.getElementById('readingAttendance');
      
      const spellingHomework = document.getElementById('spellingHomework');
      const spellingExams = document.getElementById('spellingExams');
      const spellingAttendanceEval = document.getElementById('spellingAttendance');
      
      const attendanceStatus = document.getElementById('attendanceStatus');
      const homeworkStatus = document.getElementById('homeworkStatus');
      const saveEvaluation = document.getElementById('saveEvaluation');
      const cancelEvaluate = document.getElementById('cancelEvaluate');

      let students = [];
      let currentStudentId = null;
      let currentPhoto = null;

      // ÿØÿßŸÑÿ© Debounce ŸÑŸÑÿ®ÿ≠ÿ´
      function debounce(fn, delay=300){
        let timer;
        return (...args) => {
          clearTimeout(timer);
          timer = setTimeout(()=> fn(...args), delay);
        };
      }

      // ŸÖÿπÿßŸÑÿ¨ ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©
      photoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            currentPhoto = e.target.result;
            photoPreview.innerHTML = `<img src="${currentPhoto}" alt="ÿµŸàÿ±ÿ© ÿßŸÑÿ∑ÿßŸÑÿ®">`;
          };
          reader.readAsDataURL(file);
        }
      });

      // ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿØÿßŸÑ
      function openModal(modal){
        modal.setAttribute('aria-hidden','false');
        const firstInput = modal.querySelector('input, select, button');
        if(firstInput) firstInput.focus();
      }
      function closeModal(modal){
        modal.setAttribute('aria-hidden','true');
        clearForm();
      }

      // ŸÖÿ≥ÿ≠ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
      function clearForm() {
        studentName.value = '';
        studentGrade.value = '';
        photoPreview.innerHTML = 'üì∑';
        currentPhoto = null;
        
        // ŸÖÿ≥ÿ≠ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸàÿßÿØ
        religionHomework.value = '';
        religionExams.value = '';
        religionAttendance.value = '';
        readingHomework.value = '';
        readingExams.value = '';
        readingAttendanceEval.value = '';
        spellingHomework.value = '';
        spellingExams.value = '';
        spellingAttendanceEval.value = '';
        
        // ŸÖÿ≥ÿ≠ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ®
        document.querySelectorAll('input[name="behavior"]').forEach(input => {
          input.checked = false;
        });
        
        attendanceStatus.value = '';
        homeworkStatus.value = '';
        currentStudentId = null;
      }

      // ÿ≠ŸÅÿ∏ Ÿàÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
      function saveData(){
        window.studentsData = JSON.stringify(students);
      }
      function loadData(){
        const data = window.studentsData;
        students = data ? JSON.parse(data) : [];
      }

      // ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ
      saveStudent.addEventListener('click', ()=>{
        const name = studentName.value.trim();
        const grade = studentGrade.value;
        
        if(!name || !grade) {
          alert('‚ö†Ô∏è Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
          return;
        }

        const student = {
          id: Date.now() + Math.random(),
          name, grade,
          photo: currentPhoto,
          grades: {
            ÿßŸÑÿØŸäŸÜ: { homework: 0, exams: 0, attendance: 0 },
            ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: { homework: 0, exams: 0, attendance: 0 },
            ÿßŸÑÿ•ŸÖŸÑÿßÿ°: { homework: 0, exams: 0, attendance: 0 }
          },
          behavior: '',
          attendance: [],
          homework: [],
          createdAt: new Date().toISOString()
        };

        students.push(student);
        saveData();
        render();
        closeModal(addModal);
        alert('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ∑ÿßŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠!');
      });

      // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
      function evaluateStudent(studentId) {
        const student = students.find(s => s.id == studentId);
        if (!student) return;
        
        currentStudentId = studentId;
        currentStudentName.textContent = `${student.name} - ${student.grade}`;
        
        // ÿπÿ±ÿ∂ ÿßŸÑÿØÿ±ÿ¨ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
        const grades = student.grades;
        religionHomework.value = grades.ÿßŸÑÿØŸäŸÜ?.homework || '';
        religionExams.value = grades.ÿßŸÑÿØŸäŸÜ?.exams || '';
        religionAttendance.value = grades.ÿßŸÑÿØŸäŸÜ?.attendance || '';
        
        readingHomework.value = grades.ÿßŸÑŸÇÿ±ÿßÿ°ÿ©?.homework || '';
        readingExams.value = grades.ÿßŸÑŸÇÿ±ÿßÿ°ÿ©?.exams || '';
        readingAttendanceEval.value = grades.ÿßŸÑŸÇÿ±ÿßÿ°ÿ©?.attendance || '';
        
        spellingHomework.value = grades.ÿßŸÑÿ•ŸÖŸÑÿßÿ°?.homework || '';
        spellingExams.value = grades.ÿßŸÑÿ•ŸÖŸÑÿßÿ°?.exams || '';
        spellingAttendanceEval.value = grades.ÿßŸÑÿ•ŸÖŸÑÿßÿ°?.attendance || '';
        
        // ÿπÿ±ÿ∂ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ® ÿßŸÑÿ≠ÿßŸÑŸä
        if (student.behavior) {
          document.querySelector(`input[name="behavior"][value="${student.behavior}"]`).checked = true;
        }
        
        openModal(evaluateModal);
      }

      // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
      saveEvaluation.addEventListener('click', ()=>{
        if (!currentStudentId) return;
        
        const student = students.find(s => s.id == currentStudentId);
        if (!student) return;

        // ÿ≠ŸÅÿ∏ ÿØÿ±ÿ¨ÿßÿ™ ÿßŸÑŸÖŸàÿßÿØ
        student.grades.ÿßŸÑÿØŸäŸÜ = {
          homework: parseInt(religionHomework.value) || 0,
          exams: parseInt(religionExams.value) || 0,
          attendance: parseInt(religionAttendance.value) || 0
        };
        
        student.grades.ÿßŸÑŸÇÿ±ÿßÿ°ÿ© = {
          homework: parseInt(readingHomework.value) || 0,
          exams: parseInt(readingExams.value) || 0,
          attendance: parseInt(readingAttendanceEval.value) || 0
        };
        
        student.grades.ÿßŸÑÿ•ŸÖŸÑÿßÿ° = {
          homework: parseInt(spellingHomework.value) || 0,
          exams: parseInt(spellingExams.value) || 0,
          attendance: parseInt(spellingAttendanceEval.value) || 0
        };

        // ÿ≠ŸÅÿ∏ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ®
        const behaviorRadio = document.querySelector('input[name="behavior"]:checked');
        if (behaviorRadio) {
          student.behavior = behaviorRadio.value;
        }

        const today = new Date().toISOString().split('T')[0];

        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ≠ÿ∂Ÿàÿ±
        if (attendanceStatus.value) {
          const existingIndex = student.attendance.findIndex(a => a.date === today);
          const record = {
            date: today,
            status: attendanceStatus.value,
            present: attendanceStatus.value === 'present' || attendanceStatus.value === 'late'
          };
          
          if (existingIndex >= 0) {
            student.attendance[existingIndex] = record;
          } else {
            student.attendance.push(record);
          }
        }

        // ÿ≠ŸÅÿ∏ ÿßŸÑŸàÿßÿ¨ÿ®
        if (homeworkStatus.value) {
          const existingIndex = student.homework.findIndex(h => h.date === today);
          const record = {
            date: today,
            status: homeworkStatus.value,
            completed: homeworkStatus.value === 'completed'
          };
          
          if (existingIndex >= 0) {
            student.homework[existingIndex] = record;
          } else {
            student.homework.push(record);
          }
        }

        saveData();
        render();
        closeModal(evaluateModal);
        alert('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇŸäŸäŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!');
      });

      // ÿßŸÑÿ®ÿ≠ÿ´
      searchInput.addEventListener('input', debounce(e=>{
        render(e.target.value.trim());
      }));

      // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿπÿßŸÖ ŸÑŸÑÿ∑ÿßŸÑÿ®
      function calculateOverallAverage(grades) {
        let total = 0;
        let count = 0;
        
        Object.values(grades).forEach(subject => {
          if (subject.homework !== undefined && subject.exams !== undefined && subject.attendance !== undefined) {
            total += (subject.homework + subject.exams + subject.attendance);
            count += 3;
          }
        });
        
        return count > 0 ? (total / count).toFixed(1) : 0;
      }

      // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÜÿµ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ®
      function getBehaviorText(behavior) {
        switch(behavior) {
          case 'excellent': return 'ŸÖŸÖÿ™ÿßÿ≤ ‚≠ê';
          case 'good': return 'ÿ¨ŸäÿØ üëç';
          case 'needs-improvement': return 'ŸÖÿ≠ÿ™ÿßÿ¨ Ÿäÿ¥ÿØ ÿ≠ŸäŸÑŸá üí™';
          default: return 'ŸÑŸÖ ŸäŸèŸÇŸäŸÖ ÿ®ÿπÿØ';
        }
      }

      // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÅÿ¶ÿ© CSS ŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¢ÿØÿßÿ®
      function getBehaviorClass(behavior) {
        switch(behavior) {
          case 'excellent': return 'behavior-excellent';
          case 'good': return 'behavior-good';
          case 'needs-improvement': return 'behavior-needs-improvement';
          default: return '';
        }
      }

      // ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿßÿ®
      function render(searchTerm = ''){
        studentsGrid.innerHTML = '';
        
        let filteredStudents = students;
        if (searchTerm) {
          filteredStudents = students.filter(s => 
            s.name.includes(searchTerm) || s.grade.includes(searchTerm)
          );
        }

        if (filteredStudents.length === 0) {
          if (searchTerm) {
            studentsGrid.innerHTML = `<div class="empty-state">
              <div class="icon">üîç</div>
              <div>ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÑŸÑÿ®ÿ≠ÿ´: "${searchTerm}"</div>
            </div>`;
          } else {
            studentsGrid.innerHTML = `<div class="empty-state">
              <div class="icon">üë•</div>
              <div>ŸÑÿß ŸäŸàÿ¨ÿØ ÿ∑ŸÑÿßÿ® ŸÖÿ≥ÿ¨ŸÑŸäŸÜ</div>
              <div style="margin-top:10px; font-size:1rem;">ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ" ŸÑŸÑÿ®ÿØÿ°</div>
            </div>`;
          }
          return;
        }

        filteredStudents.forEach(student => {
          const grades = student.grades;
          const average = calculateOverallAverage(grades);
          
          const attendanceRate = student.attendance.length > 0 
            ? Math.round((student.attendance.filter(a => a.present).length / student.attendance.length) * 100)
            : 0;

          const homeworkCount = student.homework.filter(h => h.completed).length;
          
          const behaviorText = getBehaviorText(student.behavior);
          const behaviorClass = getBehaviorClass(student.behavior);

          const card = document.createElement('div');
          card.className = 'student-card';
          card.onclick = () => evaluateStudent(student.id);
          
          const photoHtml = student.photo 
            ? `<img src="${student.photo}" alt="ÿµŸàÿ±ÿ© ${student.name}">`
            : 'üë§';
          
          card.innerHTML = `
            <div class="student-photo">${photoHtml}</div>
            <div class="student-info">
              <h3>${student.name}</h3>
              <div class="grade">${student.grade}</div>
              <div class="behavior-indicator ${behaviorClass}">
                ${behaviorText}
              </div>
              <div class="student-stats">
                <div class="stat">
                  <span class="stat-value">${average}</span>
                  <div class="stat-label">ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿπÿßŸÖ</div>
                </div>
                <div class="stat">
                  <span class="stat-value">${attendanceRate}%</span>
                  <div class="stat-label">ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ±</div>
                </div>
                <div class="stat">
                  <span class="stat-value">${homeworkCount}</span>
                  <div class="stat-label">Ÿàÿßÿ¨ÿ®ÿßÿ™ ŸÖŸÉÿ™ŸÖŸÑÿ©</div>
                </div>
              </div>
              <div class="quick-actions">
                <button class="action-btn btn-evaluate" onclick="event.stopPropagation(); evaluateStudent(${student.id})">
                  üìù ÿ™ŸÇŸäŸäŸÖ ÿ≥ÿ±Ÿäÿπ
                </button>
              </div>
            </div>
          `;
          
          studentsGrid.appendChild(card);
        });
      }

      // ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
      btnAdd.onclick = () => openModal(addModal);
      cancelAdd.onclick = () => closeModal(addModal);
      cancelEvaluate.onclick = () => closeModal(evaluateModal);
      
      // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ ÿ®ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿá
      [addModal, evaluateModal].forEach(modal => {
        modal.onclick = (e) => {
          if (e.target === modal) closeModal(modal);
        };
        modal.querySelector('.close').onclick = () => closeModal(modal);
      });

      // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ ÿ®ÿßŸÑŸÄ Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (addModal.getAttribute('aria-hidden') === 'false') closeModal(addModal);
          if (evaluateModal.getAttribute('aria-hidden') === 'false') closeModal(evaluateModal);
        }
      });

      // ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿØÿßŸÑÿ© ÿπÿßŸÑŸÖŸäÿßŸã
      window.evaluateStudent = evaluateStudent;

      // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
      loadData();
      render();
    })();
  </script>
</body>
</html>
